Ниже представлен ряд вопросов по SQL.
Это те вопросы, которые интервьюеры часто задают на собеседованиях. Я старался подобрать как можно больше вопросов, которые задают аналитикам/инженерам данных.
После каждого вопроса дан ответ. Но для самопроверки попробуйте сперва ответить сами, не подглядывая в шпаргалку.

#### Что такое SQL?
<details>
<summary>Ответ</summary>
SQL  (Structured Query Language) расшифровывается как язык структурированных запросов. Это стандартный язык для СУБД. Он особенно полезен при обработке организованных данных, состоящих из сущностей (переменных) и отношений между различными сущностями данных.
</details>

#### Что такое таблицы и поля?
<details>
<summary>Ответ</summary>
Таблица - это организованный набор данных, хранящихся в виде строк и столбцов. Столбцы могут быть классифицированы как вертикальные поля, а строки - как горизонтальные. Поля - это колонки в таблице, предназначенные для хранения информации.
</details>

#### Что такое база данных?
<details>
<summary>Ответ</summary>
Можно дать несколько разных определений. Ниже представлены те, которые я считаю наиболее удачными.

_База данных_ - это совокупность данных, хранящихся и извлекаемых в цифровом виде из удалённой или локальной компьютерной системы.

_База данных_ - это упорядоченный набор структурированной информации или данных, которые обычно хранятся в электронном виде в компьютерной системе. База данных обычно управляется системой управления базами данных (СУБД).

_База данных_ - это совокупность данных, хранимых в соответствии со схемой данных, манипулирование которыми выполняют в соответствии с правилами средств моделирования данных
</details>

#### Что такое СУБД?
<details>
<summary>Ответ</summary>
СУБД расшифровывается как Система Управления Базами Данных. СУБД - это системное программное обеспечение, ответственное за создание, поиск, обновление и управление базы данных. СУБД гарантирует, наши данные организованы и легкодоступны, выступая в качестве интерфейса между базой данных и её конечными пользователями.
</details>

#### Что такое РСУБД? В чём заключается её отличие от СУБД?
<details>
<summary>Ответ</summary>
_РСУБД_ - Реляционная Система Управления Базами Данных. Ключевое отличие здесь, по сравнению с СУБД, заключается в том, что РСУБД хранит данные в виде набора таблиц, и между общими полями этих таблиц могут существовать отношения. Большинство современных систем управления базами данных, таких как MySQL, Microsoft SQL Server, Oracle, IBM DB2 и Amazon Redshift, основаны на РСУБД.
</details>

#### Что такое нормализация?
<details>
<summary>Ответ</summary>
Нормализация — это процесс организации данных в базе данных, включающий создание таблиц и установление отношений между ними в соответствии с правилами, которые обеспечивают защиту данных и делают базу данных более гибкой, устраняя избыточность и несогласованные зависимости.
</details>

#### Что такое денормализация?
<details>
<summary>Ответ</summary>
Денормализация - это процесс обратный нормализации. При денормализации нормализованная схема преобразуется в схему, содержащую избыточную информацию. Производительность повышается за счет использования избыточности и обеспечения согласованности избыточных данных. Причиной выполнения денормализации являются накладные расходы, возникающие в процессоре запросов из-за чрезмерно нормализованной структуры.
</details>

#### Расскажите про нормальные формы. Какие они бывают и чем отличаются?
<details>
<summary>Ответ</summary>

_Нормальная форма_ — требование, предъявляемое к структуре таблиц в теории реляционных баз данных для устранения из базы избыточных функциональных зависимостей между атрибутами (полями таблиц).
Всего существует шесть нормальных форм. Самая основная и наиболее часто используемая - третья нормальная форма (3НФ), по этому тут будет дано определение только первых трёх нормальных форм.

_Первая нормальная форма_ - оношение находится в 1НФ, если все его атрибуты[^1] являются простыми, все используемые домены[^2] должны содержать только скалярные значения. Не должно быть повторений строк в таблице.

_Вторая нормальная форма_ - отношение находится во 2НФ, если оно находится в 1НФ и каждый не ключевой атрибут неприводимо зависит от Первичного Ключа(ПК). Неприводимость означает, что в составе потенциального ключа отсутствует меньшее подмножество атрибутов, от которого можно также вывести данную функциональную зависимость.

_Третья нормальная форма_ - отношение находится в 3НФ, когда находится во 2НФ и каждый не ключевой атрибут нетранзитивно зависит от первичного ключа. Проще говоря, требуется выносить все не ключевые поля, содержимое которых может относиться к нескольким записям таблицы в отдельные таблицы.

_Нормальная форма Бойса-Кодда (НФБК)_ - это частная форма третьей нормальной формы.

Определение 3НФ не совсем подходит для следующих отношений:
1) отношение имеет два или более потенциальных ключа;
2) два и более потенциальных ключа являются составными;
3) они пересекаются, т.е. имеют хотя бы один общий атрибут.

Для отношений, имеющих один потенциальный ключ (первичный), НФБК является 3НФ. Отношение находится в НФБК, когда каждая нетривиальная и неприводимая слева функциональная зависимость обладает потенциальным ключом в качестве детерминанта.

[^1]: Атрибут — свойство некоторой сущности. Часто называется полем таблицы.

[^2]: Домен атрибута — множество допустимых значений, которые может принимать атрибут.
</details>

#### Из каких подмножеств состоит SQL?
<details>
<summary>Ответ</summary>
DDL (Data Definition Language, язык описания данных) — позволяет выполнять различные операции с базой данных, такие как CREATE (создание), ALTER (изменение) и DROP (удаление объектов).
DML (Data Manipulation Language, язык управления данными) — позволяет получать доступ к данным и манипулировать ими, например, вставлять, обновлять, удалять и извлекать данные из базы данных.
DCL (Data Control Language, язык контролирования данных) — позволяет контролировать доступ к базе данных. Пример — GRANT (предоставить права), REVOKE (отозвать права).
</details>

#### Что такое первичный ключ?
<details>
<summary>Ответ</summary>
Первичный ключ (PRIMARY KEY) предназначен для однозначной идентификации каждой записи в таблице и является строго уникальным (UNIQUE): две записи таблицы не могут иметь одинаковые значения первичного ключа. Нулевые значения (NULL) в PRIMARY KEY не допускаются. Если в качестве PRIMARY KEY используется несколько полей, их называют составным ключом.
</details>

#### Когда используется первичный ключ?
<details>
<summary>Ответ</summary>
Первичный ключ используется в качестве основного ключа и может быть использован для связи с дочерней таблицей, содержащей внешний ключ.
</details>

#### Что такое внешний ключ?
<details>
<summary>Ответ</summary>
Внешний ключ или FOREIGN KEY также является атрибутом ограничения и обеспечивает связь двух таблиц. По сути, это поле или несколько полей, которые ссылаются на PRIMARY KEY в родительской таблице.
</details>

#### Чем NULL отличается от 0?
<details>
<summary>Ответ</summary>
0 - это число.
NULL - это не число, а также NULL не является значением пустой строки. NULL используется для указания того, что данные отсутствуют, неизвестны, неприменимы. NULL не равен ничему, даже другому NULL.
</details>

#### Перечислите различные типы связей.
<details>
<summary>Ответ</summary>

_Один-к-одному (One-to-One)_ - этот тип может быть определён как отношение между двумя таблицами, где каждая запись в одной таблице связана максимум с одной записью в другой таблице.
_Один-ко-многим и Многие-к-одному (One-to-Many & Many-to-One)_ - это наиболее часто используемое отношение, когда запись в таблице связана с несколькими записями в другой таблице.
_Многие-ко-многим (Many-to-Many)_ - этот тип используется в случаях, когда для определения отношения требуется несколько экземпляров с обеих сторон.
</details>


#### Что такое схема Звезда и Снежинка? Опишите их сходства и отличия.
<details>
<summary>Ответ</summary>
Схемы «звезда» и «снежинка» — это два способа структурировать хранилище данных.

Схема типа «звезда» имеет централизованное хранилище данных, которое хранится в таблице фактов. Схема разбивает таблицу фактов на ряд денормализованных таблиц измерений. Таблица фактов содержит агрегированные данные, которые будут использоваться для составления отчетов, а таблица измерений описывает хранимые данные.

Денормализованные проекты менее сложны, потому что данные сгруппированы. Таблица фактов использует только одну ссылку для присоединения к каждой таблице измерений. Более простая конструкция звездообразной схемы значительно упрощает написание сложных запросов.



Схема «звезды», схема звёздного соединения, звездоподобная схема, звёздная схема (от англ. star schema) — специальная организация реляционных таблиц, удобная для хранения многомерных показателей. Лежит в основе реляционного OLAP.

Модель данных состоит из двух типов таблиц: одной таблицы фактов (fact table) — центр «звезды» — и нескольких таблиц измерений (dimension table) по числу измерений в модели данных — лучи «звезды».

Пример схемы звёздного соединения
Таблица фактов обычно содержит одну или несколько колонок типа DECIMAL, дающих числовую характеристику какому-то аспекту предметной области (например, объём продаж для торговой компании или сумма платежей для банка), и несколько целочисленных колонок-ключей для доступа к таблицам измерений. В таблицы фактов данные должны оперативно записываться в случае изменений.

Таблицы измерений расшифровывают ключи, на которые ссылается таблица фактов; например, таблица «products» измерения «товары» базы данных торговой компании может содержать сведения о названии товара, его производителе, типе товара. За счёт использования специальной структуры таблицы измерений реализуется иерархия измерений, в том числе ветвящаяся.

Обычно данные в таблицах-измерениях денормализованы: ценой несколько неэффективного использования дискового пространства удается уменьшить число участвующих в операции соединения таблиц, что обычно приводит к сильному уменьшению времени выполнения запроса. Иногда, тем не менее, требуется произвести нормализацию таблиц-измерений; такая схема носит название «снежинка» (snowflake schema).

SQL-запрос к схеме «звезда» обычно содержит в себе:

одно или несколько соединений таблицы фактов с таблицами измерений;
несколько фильтров (SQL-оператор WHERE), применяемых к таблице фактов или таблицам измерений;
группировку и агрегирование по требуемым элементам иерархии измерений (dimension elements).




Схема типа «снежинка» (snowflake schema) отличается тем, что использует нормализованные данные. Нормализация означает эффективную организацию данных так, чтобы все зависимости данных были определены, и каждая таблица содержала минимум избыточности. Таким образом, отдельные таблицы измерений разветвляются на отдельные таблицы измерений.

Схема «снежинки» использует меньше дискового пространства и лучше сохраняет целостность данных. Основным недостатком является сложность запросов, необходимых для доступа к данным — каждый запрос должен пройти несколько соединений таблиц, чтобы получить соответствующие данные.




Схема снежинки (англ. snowflake schema) получила своё название за свою форму, в виде которой отображается логическая схема таблиц в многомерной базе данных. Так же как и в схеме звезды, схема снежинки представлена централизованной таблицей фактов, соединенной с таблицами измерений. Отличием является то, что здесь таблицы измерений нормализованы с рядом других связанных измерительных таблиц, — в то время как в схеме звезды таблицы измерений полностью денормализованы, с каждым измерением представленным в виде единой таблицы, без соединений на связанные таблицы в схеме снежинки. Чем больше степень нормализации таблиц измерений, тем сложнее выглядит структура схемы снежинки. Создаваемый «эффект снежинки» затрагивает только таблицы измерений, и не применим к таблицам фактов.

Использование
Схема снежинки, также как и схема звезды, наиболее часто встречается в таких хранилищах данных, для которых скорость получения данных более важна, чем эффективность манипуляции ими. Следовательно, таблицы должны быть нормализованы в малой степени, и зачастую разрабатываются с применением не выше третьего уровня нормализации.

Решение в сторону использования схемы звезды или же схемы снежинки, обуславливается относительной мощностью платформы БД, и инструментария для реализации запросов. Схема звезды подходит окружению, в котором инструментарий реализации запросов предоставляет пользователям широкий доступ к структуре таблиц, а также в окружениях, где большинство запросов просты по своей природе. Схема снежинки более подходит для случаев применения более сложного инструментария для реализации запросов, который в большей степени изолирует пользователей от детальной структуры таблиц, а также для среды с множеством запросов сложной структуры.



Для простоты понимания можно считать, что "снежинка" состоит из нескольких "звёзд".

Примеры схем звезда и снежинка.

![image](https://github.com/TalkoDenis/interviews/blob/main/SQL/Theory/%D0%97%D0%B2%D0%B5%D0%B7%D0%B4%D0%B0%20%D0%B8%20%D1%81%D0%BD%D0%B5%D0%B6%D0%B8%D0%BD%D0%BA%D0%B0%202.gif)


![image](https://github.com/TalkoDenis/interviews/blob/main/SQL/Theory/%D0%97%D0%B2%D0%B5%D0%B7%D0%B4%D0%B0%20%D0%B8%20%D1%81%D0%BD%D0%B5%D0%B6%D0%B8%D0%BD%D0%BA%D0%B0.gif)

</details>

#### Что такое таблица фактов и таблица измерений?
<details>
<summary>Ответ</summary>
Таблицы фактов — это таблицы, записи которых являются неизменяемыми "фактами", такими как журналы служб и сведения об измерениях. Записи постепенно добавляются в таблицу потоковой передачей или большими блоками. Записи остаются там до тех пор, пока они не будут удалены из-за затрат или из-за потери их стоимости. В противном случае записи никогда не обновляются.

Данные сущностей иногда хранятся в фактических таблицах, где данные сущности изменяются медленно. Например, данные о какой-либо физической сущности, такой как офисное оборудование, которое редко меняет расположение. Так как данные в Kusto являются неизменяемыми, обычно каждая таблица содержит два столбца:

Столбец идентификатора (string), который идентифицирует сущность
Столбец метки времени последнего изменения (datetime)
Затем извлекается только последняя запись для каждого удостоверения сущности.


Таблица фактов — является основной таблицей хранилища данных[1][2][3][4]. Как правило, она содержит сведения об объектах или событиях, совокупность которых будет в дальнейшем анализироваться. Обычно говорят о четырёх наиболее часто встречающихся типах фактов. К ним относятся:

факты, связанные с транзакциями (англ. Transaction facts). Они основаны на отдельных событиях (типичными примерами которых являются телефонный звонок или снятие денег со счёта с помощью банкомата);
факты, связанные с «моментальными снимками» (англ. Snapshot facts). Основаны на состоянии объекта (например, банковского счёта) в определённые моменты времени, например на конец дня или месяца. Типичными примерами таких фактов являются объём продаж за день или дневная выручка;
факты, связанные с элементами документа (англ. Line-item facts). Основаны на том или ином документе (например, счёте за товар или услугу) и содержат подробную информацию об элементах этого документа (например, количестве, цене, проценте скидки);
факты, связанные с событиями или состоянием объекта (англ. Event or state facts). Представляют возникновение события без подробностей о нём (например, просто факт продажи или факт отсутствия таковой без иных подробностей).
Таблица фактов, как правило, содержит уникальный составной ключ, объединяющий первичные ключи таблиц измерений. Чаще всего это целочисленные значения либо значения типа «дата/время» в целочисленном формате — ведь таблица фактов может содержать сотни тысяч или даже миллионы записей, и хранить в ней повторяющиеся текстовые описания, как правило, невыгодно — лучше поместить их в меньшие по объёму таблицы измерений. При этом как ключевые, так и некоторые неключевые поля должны соответствовать будущим измерениям OLAP-куба. Помимо этого, таблица фактов содержит одно или несколько числовых полей, на основании которых в дальнейшем будут получены агрегатные данные.

Для многомерного анализа пригодны таблицы фактов, содержащие как можно более подробные данные (то есть соответствующие членам нижних уровней иерархии соответствующих измерений). В данном случае предпочтительнее взять за основу факты продажи товаров отдельным заказчикам, а не суммы продаж для разных стран — последние все равно будут вычислены OLAP-средством, в случае использования такового. Исключение можно сделать, пожалуй, только для клиентских OLAP-средств, поскольку в силу ряда ограничений они не могут манипулировать большими объёмами данных.

В таблице фактов нет никаких сведений о том, как группировать записи при вычислении агрегатных данных. Например, в ней есть идентификаторы продуктов или клиентов, но отсутствует информация о том, к какой категории относится данный продукт или в каком городе находится данный клиент. Эти сведения, в дальнейшем используемые для построения иерархий в измерениях куба, содержатся в таблицах измерений. В случае построения отчетов напрямую из хранилища данных, минуя промежуточный шаг создания OLAP-кубов, также могут использоваться так называемые агрегатные таблицы фактов, содержащие крупнозернистую информацию, например суммарные траты покупателя в выбранном магазине за месяц, вместо или в дополнение к детальной таблице фактов с подробной информацией о каждой покупке.




Таблицы измерений
Таблицы измерений:

Хранение ссылочных данных, таких как таблицы подстановки, от идентификатора сущности до ее свойств
Хранение данных, подобных snapshot, в таблицах, все содержимое которых изменяется в одной транзакции
Таблицы измерений не регулярно помечаются с новыми данными. Вместо этого все содержимое данных обновляется одновременно с помощью таких операций, как .set-or-replace, .move extents или .rename tables.

Иногда таблицы измерений могут быть производными от таблиц фактов. Этот процесс можно выполнить с помощью политики обновления в таблице фактов с запросом к таблице, которая принимает последнюю запись для каждой сущности.

Различения таблиц фактов и измерений
В Kusto существуют процессы, которые различают таблицы фактов и таблицы измерений. Один из них — непрерывный экспорт.

Эти механизмы гарантированно обрабатывают данные в фактических таблицах точно один раз. Они полагаются на механизм курсора базы данных .

Например, при каждом выполнении задания непрерывного экспорта экспортируются все записи, которые были приема с момента последнего обновления курсора базы данных. Задания непрерывного экспорта должны различать таблицы фактов и таблицы измерений. Таблицы фактов обрабатывают только недавно обработанные данные, а таблицы измерений используются в качестве подстановок. Таким образом, необходимо учитывать всю таблицу.

Невозможно пометить таблицу как таблицу фактов или таблицу измерений. Способ приема данных в таблицу и способ ее использования определяет ее тип.





Таблица измерений (англ. dimension table) — таблица в структуре многомерной базы данных, которая содержит атрибуты событий, сохраненных в таблице фактов. Атрибуты представляют собой текстовые или иные описания, логически объединенные в одно целое. Например, имя покупателя может являться атрибутом в таблице измерений покупателей, а наименование товара, — в таблице измерений товаров. В то время как сумма транзакции является величиной аддитивной, и её значение должно храниться в таблице фактов.

Таблица фактов связана с таблицами измерений с помощью внешнего ключа.

С течением времени значения атрибутов строки в таблице измерений могут измениться. Например, юридический адрес компании или отдел компании, в котором работает сотрудник. Для отслеживания и обработки в таком случае используют медленно меняющиеся измерения[1]. Есть несколько типов обработки таких изменений:

Первый тип: Перезаписать старые значения.
Второй тип: Добавить новую строку, содержащую новые значения, сохраняя бизнес-ключ для различия строк.
Третий тип: Добавить новый атрибут в существующую строку.

</details>





















